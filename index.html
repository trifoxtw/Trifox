<!DOCTYPE html>
<html>
<head>
    <title>LINE LIFF QR Code Scanner</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
    <button onclick="scanQRCode()">掃描 QR Code</button>
    <script>
        async function initializeLIFF() {
            try {
                await liff.init({ liffId: '2008054767-e2XRvkLr' }); // 替換為你的 LIFF ID
                if (!liff.isLoggedIn()) {
                    liff.login(); // 未登入則要求使用者登入
                } else {
                    const profile = await liff.getProfile(); // 取得使用者資料
                    const userId = profile.userId; // 取得 LINE 使用者 ID
                    console.log('User ID:', userId);
                }
            } catch (error) {
                console.error('LIFF 初始化失敗:', error);
            }
        }

        async function scanQRCode() {
            try {
                if (!liff.isLoggedIn()) {
                    liff.login();
                    return;
                }
                const result = await liff.scanCodeV2(); // 掃描 QR Code
                const qrContent = result.value; // 取得 QR Code 內容
                console.log('QR Code 內容:', qrContent);

                const profile = await liff.getProfile();
                const userId = profile.userId;

                // 將使用者 ID 代入 Google 表單
                fillGoogleForm(userId, qrContent);
            } catch (error) {
                console.error('QR Code 掃描失敗:', error);
            }
        }

        function fillGoogleForm(userId, qrContent) {
            // Google 表單的預填連結
            const formUrl = 'YOUR_GOOGLE_FORM_URL'; // 替換為你的 Google 表單預填連結
            const prefilledUrl = `${formUrl}?entry.123456789=${encodeURIComponent(userId)}&entry.987654321=${encodeURIComponent(qrContent)}`;
            window.location.href = prefilledUrl; // 跳轉到預填表單
        }

        // 初始化 LIFF
        initializeLIFF();
    </script>
</body>
</html>
