<!DOCTYPE html>
<html>
<head>
    <title>LINE LIFF QR Code Check-in</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        .checkin-button {
            display: block;
            margin: 15px auto;
            padding: 20px 30px;
            font-size: 24px;
            font-weight: bold;
            color: white;
            border: none;
            border-radius: 10px;
            width: 80%;
            max-width: 400px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .checkin-button:hover {
            transform: scale(1.05);
        }
        #morning-on { background-color: #4CAF50; } /* 早診上班 - 綠色 */
        #morning-off { background-color: #FF5722; } /* 早診下班 - 橙色 */
        #noon-on { background-color: #2196F3; } /* 午診上班 - 藍色 */
        #noon-off { background-color: #F44336; } /* 午診下班 - 紅色 */
        #night-on { background-color: #9C27B0; } /* 晚診上班 - 紫色 */
        #night-off { background-color: #FFC107; } /* 晚診下班 - 黃色 */
        #result {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>
    <h2>選擇班別進行打卡</h2>
    <button id="morning-on" class="checkin-button" onclick="checkIn('早診上班')">早診上班</button>
    <button id="morning-off" class="checkin-button" onclick="checkIn('早診下班')">早診下班</button>
    <button id="noon-on" class="checkin-button" onclick="checkIn('午診上班')">午診上班</button>
    <button id="noon-off" class="checkin-button" onclick="checkIn('午診下班')">午診下班</button>
    <button id="night-on" class="checkin-button" onclick="checkIn('晚診上班')">晚診上班</button>
    <button id="night-off" class="checkin-button" onclick="checkIn('晚診下班')">晚診下班</button>
    <div id="result"></div>

    <script>
        let userId = '';

        async function initializeLIFF() {
            try {
                await liff.init({ liffId: '2008064558-DLpEARY3' });
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    const profile = await liff.getProfile();
                    userId = profile.userId;
                    console.log('User ID:', userId);
                }
            } catch (error) {
                console.error('LIFF 初始化失敗:', error);
                document.getElementById('result').innerText = 'LIFF 初始化失敗，請稍後再試。';
            }
        }

        async function checkIn(shift) {
            try {
                if (!liff.isLoggedIn()) {
                    liff.login();
                    return;
                }

                const result = await liff.scanCodeV2();
                const qrContent = result.value;
                console.log('QR Code 內容:', qrContent);

                // Google 表單預填連結
                const formUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSfkXPk4mjvH78PNfsXduF8DPg3vf3fmgIfNJXtCR5aIZR69QQ/formResponse';
                const prefilledUrl = `${formUrl}?=usp=pp_url&entry.1366094180=${encodeURIComponent(shift)}&entry.538125100=${encodeURIComponent(userId)}&entry.1841717274=${encodeURIComponent(qrContent)}`;

                // 自動提交表單（使用 iframe 隱藏提交過程）
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = prefilledUrl;
                document.body.appendChild(iframe);

                // 顯示打卡結果
                const currentTime = new Date().toLocaleString('zh-TW', { timeZone: 'Asia/Taipei' });
                document.getElementById('result').innerText = `打卡成功！\n班別：${shift}\n時間：${currentTime}`;

                // 移除 iframe
                setTimeout(() => {
                    document.body.removeChild(iframe);
                }, 2000);
            } catch (error) {
                console.error('QR Code 掃描失敗:', error);
                document.getElementById('result').innerText = 'QR Code 掃描失敗，請重試。';
            }
        }

        // 初始化 LIFF
        initializeLIFF();
    </script>
</body>
</html>



